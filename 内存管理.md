## 如何处理线上系统的内存泄露
1. 我们自己写的代码逻辑有内存泄露
2. 第三方库内存泄露

检测调试内存泄露：
1. 如果 发生了 core，可以用 GDB 调试文件
2. 如果没有发生 core，使用 top/nmon 检查内存的使用情况
3. 静态分析
   1. 比如在编译的时候用 clang、 splint、PC-LINT、BEAM 等静态代码扫描工具扫描代码，可以检测出使用了没有初始化的变量、内存泄露等等
4. 动态分析
   1. valgrind（或 Rational purify）
      1. 提供了 Memcheck 等一系列工具，可以检测 cpp 程序中内存管理的错误：
         * 读写已经释放的内存
         * 读写内存块越界（从前或者从后）
         * 使用还未初始化的变量
         * 将无意义的参数传递给系统调用
         * 内存泄漏
   2. mtrace
      1. 从 mtrace 记录和分析结果可以看到，内存记录日志只记录到 malloc 层面。而实际项目开发时，很多接口都是封装多层才会实际调用到 malloc，对于上面几层的地址，mtrace 没有记录。而上面几层的调用关系才是追踪内存泄漏问题的关键所在。所以在实际开发的项目中，使用 mtrace 不是一个特别好的方法。推荐使用 valgrind 工具进行跑流程的方式追踪内存泄漏。

解决方案：
   1. 引入内存池，在原生的 new/delete 上封装一层
   2. 在每一处申请内存和释放的地方打点，记录为日志，如果发生了内存泄露可以来对比
   3. 自动 gc


